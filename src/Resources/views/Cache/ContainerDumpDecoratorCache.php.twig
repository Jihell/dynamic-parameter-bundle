<?php
use Jihel\Plugin\DynamicParameterBundle\DependencyInjection\Factory\ParameterLoaderFactory;

/**
 * {{ prefix }}{{ parentClass }}
 *
 * This class has been auto-generated
 * and is a decorator for the container builder
 */
class {{ prefix }}{{ parentClass }} extends {{ parentClass }}
{
    /**
     * @return array An array of parameters, the cached one override the others
     */
    protected function getDefaultParameters()
    {
        // Override environment parameters
        $baseParameters         = array_merge(parent::getDefaultParameters(), $this->getEnvParameters());
        // Load dynamic parameters
        $parameterLoaderFactory = new ParameterLoaderFactory($baseParameters);
        $parametersLoader       = $parameterLoaderFactory->get();
        $dynamicParameters      = $parametersLoader->load();
        unset($parametersLoader);

        // Dynamic parameters override the default ones
        return array_merge($baseParameters, $dynamicParameters);
    }

    /**
     * Gets the environment parameters.
     *
     * Only the parameters starting with "SYMFONY__" are considered.
     *
     * @return array An array of parameters
     */
    protected function getEnvParameters()
    {
        $parameters = array();
        foreach ($_SERVER as $key => $value) {
            if (0 === strpos($key, 'SYMFONY__')) {
                $parameters[strtolower(str_replace('__', '.', substr($key, 9)))] = $value;
            }
        }

        return $parameters;
    }
}
